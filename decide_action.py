def decide_action(state_info, self_intention, opponent_intention):
    system_prompt = f"""
あなたはハンタータスクの行動決定システムです。私が指示した以外の返答は一切不要です。
これ以降、あなた自身を「自己」、協力相手のもう一体のハンターを「他者」と呼びます。

---

# ■ ハンタータスクの説明
- マップ：幅20×高さ20のグリッド。トーラス構造のため、端から出ると反対側に回り込みます。
- エンティティ：2体のハンター（自己・他者）と2体の獲物（A・B）。
- ターン制：各ターンで全エージェント（ハンターと獲物）が**同時に**1行動を実行します。
- 距離（トーラス・マンハッタン）：
  - dx = min(|x1−x2|, W−|x1−x2|), dy = min(|y1−y2|, H−|y1−y2|)
  - dist = dx + dy（W=20, H=20）
- **捕獲条件**：行動更新**後**、ハンターと獲物の**座標が一致**すると捕獲。
- ハンター同士の位置衝突：同一セルへの同時進入・停止は**許可**（ブロッキングなし）。
- エピソード終了：① 両獲物捕獲、② 最大ターン数 T 到達。
- 観測：各ターン、自己・他者・A・Bの**現在座標のみ**が観測可能。
- 目的：
- ハンターは協調的に行動し、可能な限り少ないターンで全ての獲物を捕獲することを目指します。

---

# ■ 内部表現
・自己の信念
・他者の信念
・自己の願望
・他者の願望
・自己の意図
・他者の意図

# ■ 信念・願望・意図の定義
- 信念：世界状態に関する認識の集合（複数可）。
- 願望：達成したい目標や状態（複数可）。
- 意図：願望を実現するための行動方針（同時に1つ）。
（他者の内部状態は自己の推定であり、実際と一致するとは限りません）

---

# ■ タスク
観測JSON（座標のみ）、自己の意図、他者の意図に基づき、
次ターンの**自己の行動**を {上, 下, 左, 右, その場に留まる} のいずれか1つで決定し、簡潔な理由とともに出力してください。
トーラス距離と捕獲条件に整合し、協調（無駄な重複追跡の回避）に配慮してください。

---

# ■ 出力フォーマット（厳守）
以下のJSONのみを出力してください（追加テキスト禁止）：
{{
  "次の行動": "上 / 下 / 左 / 右 / その場に留まる",
  "理由": "簡潔に説明"
}}
""".strip()

    prompt = f"""
# 入力情報（観測JSON）
{json.dumps(state_info, ensure_ascii=False, indent=2)}

自己の意図: {self_intention}
他者の意図: {opponent_intention}

# 出力指示
指定のJSONのみを返してください。
""".strip()

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user",   "content": prompt},
        ]
    )

    text = response.choices[0].message.content
    try:
        result = json.loads(text)
        return result
    except Exception:
        return {"次の行動": "不明", "理由": text}
