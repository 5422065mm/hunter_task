def generate_self_intention(state_info, self_beliefs, self_desires, opponent_intention):
    system_prompt = f"""
あなたは意図生成システムです。私が指示した以外の返答は一切不要です。
これ以降、意図生成システムであるあなたを「自己」、協力相手であるもう一体のハンターを「他者」と呼びます。

---

# ■ ハンタータスクの説明
- マップ：幅20×高さ20のグリッド。トーラス構造のため、端から出ると反対側に回り込みます。
- エンティティ：2体のハンター（自己・他者）と2体の獲物（A・B）が存在します。
- ターン制：各ターンで全エージェント（ハンターと獲物）が**同時に**1行動を実行します。
- 距離の定義（トーラス・マンハッタン距離）：
  - dx = min(|x1−x2|, W−|x1−x2|), dy = min(|y1−y2|, H−|y1−y2|)
  - dist = dx + dy（ここで W=20, H=20）
- **捕獲条件**：ターンの行動更新**後**に、ハンターと獲物の**座標が一致**したとき、その獲物は捕獲されたとみなされます。
  - 同一ターンに複数ハンターが同一獲物を捕獲した場合も、捕獲は1回として扱います。
  - 距離の定義と捕獲の条件が重なっているのか
    - 距離が０と座標が重なるのは一緒の意味
  - 2体の獲物が同ターンに別々に捕獲されることもあります。
  - 他のハンターのとることのできる動きは入れる必要がある。
    - 上に行くことはyが一つ増えることです。見ないなもの。行動と距離の関係がつながりきっていない
- ハンター同士の位置衝突：同一セルへの同時進入や停止は**許可**（ブロッキングなし）。
- エピソード終了条件：① 両方の獲物が捕獲された、または ② 最大ターン数 T に到達した場合。
- 観測：各ターンで、自己・他者・獲物A・獲物Bの**現在座標のみ**が観測可能です。
- 目的：
  - ハンターは協調的に行動し、可能な限り少ないターンで全ての獲物を捕獲することを目指します。

---

# ■ 内部表現
・自己の信念
・他者の信念
・自己の願望
・他者の願望
・自己の意図
・他者の意図

# ■ 信念・願望・意図の定義
- 信念：世界状態に関する認識の集合（複数可）
- 願望：達成したい目標や状態（複数可）
- 意図：願望を実現するための行動方針（同時に1つ）
（他者の内部状態は自己の推定であり、実際と一致するとは限りません）

---

# ■ タスク
観測JSON（座標のみ）、「自己の信念」「自己の願望」「他者の意図」から、
矛盾がなく協調的合理性の高い**自己の意図**を1文で生成してください（同時に保持できる意図は1つ）。

---

# ■ 入力（Input）
- 観測情報（JSON；座標のみ）
- 自己の信念（箇条書き）
- 自己の願望（箇条書き）
- 他者の意図（テキスト1行）

---

# ■ 出力（Output）
以下のJSONのみを出力してください（追加テキスト禁止）：
{{
  "自己の意図": "（例：他者が獲物Aを狙うなら、自分は獲物Bを狙う）"
}}
""".strip()

    user_prompt = f"""
# 観測情報（JSON；座標のみ）
{json.dumps(state_info, ensure_ascii=False, indent=2)}

# 自己の信念
{chr(10).join('・' + b for b in self_beliefs)}

# 自己の願望
{chr(10).join('・' + d for d in self_desires)}

# 他者の意図
{opponent_intention}

# 出力指示
指定JSONのみを返してください。
""".strip()

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user",   "content": user_prompt},
        ]
    )

    text = response.choices[0].message.content
    try:
        result = json.loads(text)
        self_intention = result.get("自己の意図", "不明")
    except Exception:
        self_intention = text
    print("自己の意図:", self_intention)
    return self_intention
